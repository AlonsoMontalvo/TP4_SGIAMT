@model SGIAMT_Integracion.Models.TUsuario

@{
    ViewData["Title"] = "Edit";

    Layout = "~/Views/Shared/_LayoutPerfil/_LayoutAlumno.cshtml";
}

<head>

    <title>Actualizar datos del Alumno</title>
    <link rel="stylesheet" href="~/css/RegistroStyle.css" />
</head>


<script type="text/javascript">
    function isValidDate(day, month, year) {
        var dteDate;
        // En javascript, el mes empieza en la posicion 0 y termina en la 11
        //   siendo 0 el mes de enero
        // Por esta razon, tenemos que restar 1 al mes
        month = month - 1;
        // Establecemos un objeto Data con los valore recibidos
        // Los parametros son: año, mes, dia, hora, minuto y segundos
        // getDate(); devuelve el dia como un entero entre 1 y 31
        // getDay(); devuelve un num del 0 al 6 indicando siel dia es lunes,
        //   martes, miercoles ...
        // getHours(); Devuelve la hora
        // getMinutes(); Devuelve los minutos
        // getMonth(); devuelve el mes como un numero de 0 a 11
        // getTime(); Devuelve el tiempo transcurrido en milisegundos desde el 1
        //   de enero de 1970 hasta el momento definido en el objeto date
        // setTime(); Establece una fecha pasandole en milisegundos el valor de esta.
        // getYear(); devuelve el año
        // getFullYear(); devuelve el año
        dteDate = new Date(year, month, day);
        //Devuelva true o false...
        return ((day == dteDate.getDate()) && (month == dteDate.getMonth()) && (year == dteDate.getFullYear()));
    }
    /**
     * Funcion para validar una fecha
     * Tiene que recibir:
     *  La fecha en formato ingles yyyy-mm-dd
     * Devuelve:
     *  true-Fecha correcta
     *  false-Fecha Incorrecta
     */
    function validate_fecha(fecha) {
        var patron = new RegExp("^(19|20)+([0-9]{2})([-])([0-9]{1,2})([-])([0-9]{1,2})$");
        if (fecha.search(patron) == 0) {
            var values = fecha.split("-");
            if (isValidDate(values[2], values[1], values[0])) {
                return true;
            }
        }
        return false;
    }
    function calcularEdad() {
        var fecha = document.getElementById("DuFechaNacimiento").value;
        if (validate_fecha(fecha) == true) {
            // Si la fecha es correcta, calculamos la edad
            var values = fecha.split("-");
            var dia = values[2];
            var mes = values[1];
            var ano = values[0];
            // cogemos los valores actuales
            var fecha_hoy = new Date();
            var ahora_ano = fecha_hoy.getYear();
            var ahora_mes = fecha_hoy.getMonth() + 1;
            var ahora_dia = fecha_hoy.getDate();
            // realizamos el calculo
            var edad = (ahora_ano + 1900) - ano;
            if (ahora_mes < mes) {
                edad--;
            }
            if ((mes == ahora_mes) && (ahora_dia < dia)) {
                edad--;
            }
            if (edad > 1900) {
                edad -= 1900;
            }
            // calculamos los meses
            var meses = 0;
            if (ahora_mes > mes)
                meses = ahora_mes - mes;
            if (ahora_mes < mes)
                meses = 12 - (mes - ahora_mes);
            if (ahora_mes == mes && dia > ahora_dia)
                meses = 11;
            // calculamos los dias
            var dias = 0;
            if (ahora_dia > dia)
                dias = ahora_dia - dia;
            if (ahora_dia < dia) {
                ultimoDiaMes = new Date(ahora_ano, ahora_mes, 0);
                dias = ultimoDiaMes.getDate() - (dia - ahora_dia);
            }
            document.getElementById("result").innerHTML = "Tienes " + edad + " años ";

            var categoria = document.getElementById("elementos");

            var tipousuario = document.getElementById("tipousu");

            if (tipousuario.selectedIndex == 1) {
                if (edad <= 3) {
                    alert("no existe categoria")
                    categoria.selectedIndex = 0;
                }
                else if (4 <= edad && edad <= 6) {
                    alert("Categoria Pre-infantes")
                    categoria.selectedIndex = 1;
                }
                else if (7 <= edad && edad <= 9) {
                    alert("Categoria Infantes")
                    categoria.selectedIndex = 2;
                }
                else if (10 <= edad && edad <= 13) {
                    alert("Categoria Infantil")
                    categoria.selectedIndex = 3;
                }
                else if (14 <= edad && edad <= 17) {
                    alert("Categoria Junior")
                    categoria.selectedIndex = 4;
                }
                else if (18 <= edad && edad <= 21) {
                    alert("Categoria Juvenil")
                    categoria.selectedIndex = 5;
                }
                else if (22 <= edad && edad <= 34) {
                    alert("Categoria Adultos")
                    categoria.selectedIndex = 6;
                }
                else if (35 <= edad && edad <= 49) {
                    alert("Categoria Senior")
                    categoria.selectedIndex = 7;
                }
                else if (50 <= edad && edad <= 62) {
                    alert("Categoria Master")
                    categoria.selectedIndex = 8;
                }
                else if (63 <= edad <= 100) {
                    alert("Categoria Oro")
                    categoria.selectedIndex = 9;
                }
                else {
                    alert("no tiene categoria")
                    categoria.selectedIndex = 0;

                }
            }
            else if (tipousuario.selectedIndex == 2) {
                alert("has seleccionado tipo de usuario : secretaria")
                categoria.selectedIndex = 10;
            }
            else if (tipousuario.selectedIndex == 3) {
                alert("has seleccionado tipo de usuario : Profesor")
                categoria.selectedIndex = 10;

            }
            else {
                categoria.selectedIndex = 0;
            }

            /*+meses+" meses y "+dias+" días"*/
        } else {
            document.getElementById("result").innerHTML = "La fecha " + fecha + " es incorrecta";
        }
    }


</script>

<body>
    <div class="container">
        <div class="row">
            <div class="col-10 register-right" style="width : 50% ; float :left">
                <h2>Actualizar datos del alumno</h2>
                <form asp-action="Edit">
                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                    <div class="form-group">
                        <label asp-for="PkIuDni" class="control-label"></label>
                        <input asp-for="PkIuDni" class="form-control" />
                        <span asp-validation-for="PkIuDni"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="VuNombre" class="control-label"></label>
                        <input asp-for="VuNombre" class="form-control" />
                        <span asp-validation-for="VuNombre"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="VuApaterno" class="control-label"></label>
                        <input asp-for="VuApaterno" class="form-control" />
                        <span asp-validation-for="VuApaterno"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="VuAmaterno" class="control-label"></label>
                        <input asp-for="VuAmaterno" class="form-control" />
                        <span asp-validation-for="VuAmaterno"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="VuCelular" class="control-label"></label>
                        <input asp-for="VuCelular" class="form-control" />
                        <span asp-validation-for="VuCelular" style="color:black"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="VuCorreo" class="control-label"></label>
                        <input asp-for="VuCorreo" class="form-control" />
                        <span asp-validation-for="VuCorreo"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="VuDireccion" class="control-label"></label>
                        <input asp-for="VuDireccion" class="form-control" />
                        <span asp-validation-for="VuDireccion"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="FkItuTipoUsuario" class="control-label"></label>
                        <select id="tipousu" asp-for="FkItuTipoUsuario" class="form-control" asp-items="ViewBag.FkItuTipoUsuario">
                            <option selected>seleccionar Tipo de usuario</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label asp-for="DuFechaNacimiento" class="control-label"></label>
                        <input asp-for="DuFechaNacimiento" class="form-control" name="DuFechaNacimiento" id="DuFechaNacimiento" onchange="javascript: calcularEdad()" />
                        <span asp-validation-for="DuFechaNacimiento"></span>
                        <span class="label">
                            <span style="font-size:small;color:black " id="result" value="result"></span>
                        </span>

                    </div>
                    <div class="form-group">
                        <label asp-for="VuSexo" class="control-label"></label>
                        <select class="form-control" id="VuSexo" name="VuSexo">
                            <option selected value="1">seleccionar sexo</option>
                            <option>masculino </option>
                            <option>femenino</option>
                        </select>
                        <span asp-validation-for="VuSexo"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="VuContraseña" class="control-label"></label>
                        <input asp-for="VuContraseña" class="form-control" />
                        <span asp-validation-for="VuContraseña"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="VuEstado" class="control-label"></label>
                        <input asp-for="VuEstado" class="form-control" value="inactivo" readonly="readonly" />
                        <span asp-validation-for="VuEstado"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="VuHorario" class="control-label" style="color:black"></label>
                        <select class="form-control" id="VuHorario" name="VuHorario">
                            <option selected value="1">seleccionar horarios</option>
                            <option>4:00 - 5:00 pm </option>
                            <option>5:00 - 6:00 pm </option>
                            <option>6:00 - 7:00 pm </option>
                        </select>
                        <span asp-validation-for="VuHorario"></span>
                    </div>

                    <div class="form-group">
                        <label asp-for="FkIcId" class="control-label" style="color:black"></label>
                        <select asp-for="FkIcId" id="elementos" class="form-control" asp-items="ViewBag.FkIcId">

                            <option>elegir categoria</option>

                        </select>
                    </div>

                    <div class="form-group">
                        <label asp-for="FkIdiCod" class="control-label"></label>
                        <select asp-for="FkIdiCod" class="form-control" asp-items="ViewBag.FkIdiCod">
                            <option selected>seleccionar Distrito</option>

                        </select>
                    </div>
                    <div class="form-group">
                        <input type="submit" value="Registrar" class="btn btn-success" onclick="elegir()" />

                    </div>
                    <div>
                        <a asp-controller="Alumnohome" asp-action="Alumno">atras</a>
                    </div>
                </form>
            </div>
        </div>


    </div>
</body>
<script>

    function elegir() {
        if (VuSexo.selectedIndex = 1) { alert("llene sexo") }
        else {
            VuSexo.selectedIndex = 1; {
                document.getElementById("VuSexo");
            }
        }

</script>
@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
